<!--
 * @Author: your name
 * @Date: 2022-08-29 19:32:38
 * @LastEditTime: 2023-02-22 10:17:30
 * @LastEditors: your name
 * @Description: 
 * @FilePath: \Html5_3D\testWeb\animationTest.html
 * 可以输入预定的版权声明、个性签名、空行等
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="../threeSrc/three.js"></script>
    <script src="./defultTemplate.js"></script>
    <script src="../threeSrc/libs/Tween.js"></script>
    <title>Animation Test</title>
</head>

<body>
    <button onclick="stop()">停止</button>

    <script>
        let kaiguan = true;

        function stop() {
            kaiguan = false;
        }

        document.body.appendChild(renderer.domElement); //body元素中插入canvas对象

        const geometry = new THREE.BoxGeometry(1, 1, 1);
        const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        const cube = new THREE.Mesh(geometry, material);
        scene.add(cube);
        render();

        const times = [0, 1, 2] // 时间序列
        const valuesX = [
            0, 0, 0, 10, 0, 0, 10, 10, 0
        ] // 过渡的值
        const valuesX_1 = [
            10, 0, 0, 0, 0, 0, 0, 0, 0
        ] // 过渡的值
        const valuesX_2 = [
            0, 0, 0, 10, 0, 0, 0, 0, 0
        ] // 过渡的值
        const valuesX_3 = [
            0, 0, 0, 0, 0, 0, 10, 0, 0
        ] // 过渡的值

        const quaternion1 = new THREE.Quaternion();
        const euler1 = new THREE.Euler(0, 0, 0, 'XYZ');
        quaternion1.setFromEuler(euler1);

        const quaternion2 = new THREE.Quaternion();
        const euler2 = new THREE.Euler(0, Math.PI, 0, 'XYZ');
        quaternion2.setFromEuler(euler2);

        const valuesY = [
            quaternion1.x, quaternion1.y, quaternion1.z, quaternion1.w, quaternion2.x, quaternion2.y, quaternion2.z, quaternion2.w
        ] // 过渡的值

        // 0 - 10 秒内的位置变化
        const posXKeyFramTrack = new THREE.KeyframeTrack('.position', times, valuesX);
        const posXKeyFramTrack_1 = new THREE.KeyframeTrack('.position', times, valuesX_1);
        const posXKeyFramTrack_2 = new THREE.KeyframeTrack('.position', times, valuesX_2);
        const posXKeyFramTrack_3 = new THREE.KeyframeTrack('.position', times, valuesX_3);

        const visibleKeyFramTrack = new THREE.BooleanKeyframeTrack('.visible', [0, 0.5, 1, 1.5, 2], [true, false, true, false, true]);

        const posYKeyFramTrack = new THREE.QuaternionKeyframeTrack('.quaternion', [0, 1.2], valuesY);

        // 通过THREE.AnimationClip对象对动画进行剪辑
        // name, 持续时间, KeyframeTrack<>
        const trackArr = [posXKeyFramTrack, posXKeyFramTrack_1, posXKeyFramTrack_2, posXKeyFramTrack_3, posYKeyFramTrack];
        const clip = new THREE.AnimationClip('CUBE-ANUMATION', -1, trackArr);
        // console.log(clip.duration);

        const mixer = new THREE.AnimationMixer(cube)
        const action = mixer.clipAction(clip);
        action.play();

        let tween = new TWEEN.Tween(cube.rotation);
        tween.to({ y: Math.PI / 2 }, 2000);
        tween.easing(TWEEN.Easing.Elastic.InOut);
        tween.repeat(4);
        tween.yoyo(true);
        tween.start();
        let isStart = false;
        let isEnd = false;

        let clock = new THREE.Clock();

        function animate() {
            mixer.update(clock.getDelta());
            // if (clock.getElapsedTime() > 5 && !isStart) {
            //     tween.start();
            //     isStart = true;
            // }

            // if (clock.getElapsedTime() > 25 && !isEnd) {
            //     tween.stop();
            //     // clock.stop();
            //     isEnd = true;
            //     console.log("Time's up.");
            //     return;
            // }
            // console.log(cube.position);
            render();
            if (!kaiguan) return;
            requestAnimationFrame(animate);
        }
        animate();

        // let reStart = false
        // renderer.setAnimationLoop(function () {
        //     if (clock.getElapsedTime() > 30 && !reStart) {
        //         clock.stop();
        //         console.log("Tween is restart!");
        //         tween.start();
        //         reStart = 1;
        //     }
        //     TWEEN.update();
        //     render();
        // })
    </script>
</body>

</html>